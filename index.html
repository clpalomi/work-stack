<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="./img/favicon.svg" type="image/svg+xml">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Work Log</title>
  <link rel="preconnect" href="https://esm.sh">
  <style>
    /* --- Date picker visibility fixes --- */
    .add-entry, .sheet, .dialog, .modal {
      overflow: visible !important;
      isolation: isolate;
      transform: none !important; /* avoid new stacking context that clips popups */
    }
    main, .content, .frame { overflow: visible !important; }
    /* keep the date input above neighbors */
    input[type="date"], input[type="text"].date { position: relative; z-index: 2; }

    :root{
      --bg:#0d1117; --surface:#0f141b; --surface-2:#121827; --fg:#e6eaf2;
      --muted:#9aa3b2; --border:#1f2937; --ring:#3b82f6; --accent:#10b981; --accent-2:#059669;
      --radius-lg:16px; --radius-md:12px; --shadow-lg:0 24px 60px rgba(0,0,0,.35);
      --shadow-sm:0 6px 20px rgba(0,0,0,.25); --tap:52px; --measure:74ch;
    }
    @media (prefers-color-scheme: light){
      :root{--bg:#f7f8fb;--surface:#fff;--surface-2:#f4f6fb;--fg:#0f172a;--muted:#64748b;--border:#e5e7eb;--shadow-lg:0 16px 40px rgba(15,23,42,.06);--ring:#2563eb;--accent:#0ea5e9;--accent-2:#0284c7;}
    }
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;color:var(--fg);background:var(--bg);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:flex;flex-direction:column;min-height:100svh}
    img,svg{display:block}

    /* Keep flatpickr above dialog and menus (if you enable it) */
    .flatpickr-calendar { z-index: 9999 !important; }

  .topbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center; /* <-- true centering */
  padding: 14px clamp(14px, 3vw, 24px);
  background: color-mix(in srgb, var(--bg) 92%, transparent);
  backdrop-filter: blur(6px) saturate(130%);
  border-bottom: 1px solid var(--border);
  }
    .brand{font-weight:800;letter-spacing:-.01em;font-size: clamp(22px, 3vw, 30px)}
    .sub{color:var(--muted);font-size:12px}

    .shell{width:100%;max-width:980px;margin-inline:auto;padding:clamp(12px,3vw,24px);flex:1 1 auto}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);overflow:hidden}
    .card-h{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;border-bottom:1px solid var(--border)}
    .card-t{margin:0;font-weight:800;letter-spacing:-.01em}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;color:var(--muted);border:1px solid var(--border)}

    .table-wrap{overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{position:sticky;top:0;z-index:1;text-align:left;font-weight:700;color:var(--muted);background:var(--surface-2)}
    th,td{padding:12px 16px;border-bottom:1px solid var(--border);white-space:nowrap}
    tbody tr:hover{background:color-mix(in srgb,var(--surface) 90%,transparent)}
    .right{text-align:right}
    .empty{padding:16px;color:var(--muted);text-align:center}
    .dock{position:sticky;bottom:0;padding:clamp(12px,3vw,18px);background:linear-gradient(180deg,transparent,color-mix(in srgb,var(--bg) 96%,transparent));backdrop-filter:blur(6px);border-top:1px solid var(--border)}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:10px;min-height:var(--tap);inline-size:100%;max-inline-size:760px;margin:0 auto;border:0;border-radius:18px;cursor:pointer;color:#fff;font-weight:800;letter-spacing:.01em;background:linear-gradient(180deg,var(--accent),var(--accent-2));box-shadow:var(--shadow-sm);transition:transform .06s ease,filter .15s ease,box-shadow .2s ease}
    .btn:focus-visible{outline:3px solid color-mix(in srgb,var(--ring) 60%,transparent);outline-offset:2px}
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.7;cursor:not-allowed}
    .hint{margin-top:8px;text-align:center;font-size:12px;color:var(--muted)}
    @media (prefers-reduced-motion: reduce){*{scroll-behavior:auto!important;transition:none!important}}

    /* ===== Menu (top-right) ===== */
    .hamburger{ inline-size: var(--tap); block-size: var(--tap); border:0; background:transparent; padding:0; cursor:pointer; display:grid; place-items:center; border-radius:12px; color:var(--fg) }
    .hamburger:focus-visible{ outline:3px solid color-mix(in srgb, var(--ring) 60%, transparent); outline-offset:2px }

    .menu{ position: fixed; right: clamp(12px, 3vw, 20px); top: 60px; background: var(--surface); border:1px solid var(--border); border-radius: 12px; box-shadow: var(--shadow-lg); padding: 8px; min-inline-size: 220px; opacity:0; transform: translateY(-6px); pointer-events: none; transition: opacity .16s ease, transform .16s ease; z-index: 40; }
    .menu[aria-hidden="false"]{ opacity:1; transform:none; pointer-events:auto }
    .menu-item{ display:block; width:100%; text-align:left; border:0; background:transparent; color:var(--fg); padding:10px 12px; border-radius:10px; font-weight:700; cursor:pointer }
    .menu-item:hover, .menu-item:focus-visible{ background: color-mix(in srgb, var(--surface-2) 85%, transparent); outline:0 }
    .menu-backdrop{ position:fixed; inset:0; background:transparent; z-index:30 }
    .menu-sep{ border:none; border-top:1px solid var(--border); margin:6px 4px }

    /* ===== Simple modal (About) ===== */
    .modal{ position: fixed; inset:auto 0 0 0; margin:auto; max-inline-size: 520px; background: var(--surface); color: var(--fg); border:1px solid var(--border); border-radius: 14px; box-shadow: var(--shadow-lg); padding: 16px; z-index: 60; opacity:0; transform: translateY(8px); pointer-events:none; transition: opacity .16s ease, transform .16s ease }
    .modal[aria-hidden="false"]{ opacity:1; transform:none; pointer-events:auto }
    .modal-h{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:8px }
    .modal-h h2{ margin:0; font-size:16px; font-weight:800 }
    .modal-c{ font-size:14px; color:var(--muted) }
    .modal-close{ border:0; background:transparent; color:var(--fg); cursor:pointer; inline-size: var(--tap); block-size: var(--tap); display:grid; place-items:center; border-radius:12px }
    .modal-close:focus-visible{ outline:3px solid color-mix(in srgb, var(--ring) 60%, transparent); outline-offset:2px }
    .modal-backdrop{ position:fixed; inset:0; background: rgba(0,0,0,.3); z-index:50 }

    /* Center the title and subtitle in the topbar */
    .topbar > div:first-child { text-align: center; flex: 1; }
    .brand { display: block; font-size: clamp(22px, 3vw, 30px); }
    .sub { display: block; margin-top: 2px; }

    /* ===== New toolbar + projects styles ===== */
    .toolbar { display:flex; gap:.75rem; align-items:center; margin:.75rem auto; width:100%; max-width:980px; padding:0 clamp(12px,3vw,24px); }
    .toolbar .download { display:flex; gap:.5rem; margin-left:auto; }
    .notes-toggle { display:flex; gap:.4rem; align-items:center; }

    .table { width:100%; border-collapse:collapse; font-size:0.95rem; }
    .table th, .table td { border-bottom:1px solid var(--border,#1f2937); padding:.5rem .6rem; }
    .table th { text-align:left; font-weight:600; }

    .project-lane { border:1px solid var(--border,#1f2937); border-radius:12px; padding:.75rem; background:var(--surface); }
    .project-lane h4 { margin:0 0 .5rem; font-size:1rem; display:flex; justify-content:space-between; }
    .task-bar-row { display:flex; gap:.75rem; overflow-x:auto; padding-bottom:.25rem; }
    .task-card { flex:0 0 auto; width:72px; display:flex; flex-direction:column; align-items:center; gap:.35rem; }
    .task-card .bar {
      width:100%; border-radius:10px; background:var(--bar,#7aa7ff); position:relative;
      background-image: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.18) 0,
        rgba(255,255,255,.18) calc(var(--step,8px) - 1px),
        transparent calc(var(--step,8px) - 1px),
        transparent var(--step,8px)
      );
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.06);
    }
    .task-card .label { text-align:center; font-size:.8rem; line-height:1.1; }
    .task-card .mins { font-size:.75rem; color:#9aa3b2; }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div>
      <div class="brand">Work Log</div>
      <div class="sub">Minimal • Focused</div>
    </div>
    <!-- Right controls: hamburger menu for auth -->
    <div style="display:flex; align-items:center; gap:10px">
      <div id="who" class="sub" aria-live="polite"></div>
      <button id="menu-btn" class="hamburger" aria-haspopup="menu" aria-expanded="false" aria-controls="menu" aria-label="Open menu">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M3 7h18M3 12h18M3 17h18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Toolbar -->
  <div class="toolbar" id="toolbar" hidden>
    <button id="btnAdd">+ Add entry</button>

    <label class="notes-toggle">
      <input type="checkbox" id="chkNotes" />
      Show Notes
    </label>

    <div class="download">
      <button id="btnDownloadCsv">Download CSV</button>
      <button id="btnDownloadXlsx">Download XLSX</button>
    </div>
  </div>

  <!-- Flyout menu -->
  <div id="menu" class="menu" role="menu" aria-hidden="true">
    <button id="menu-my" class="menu-item" role="menuitem">My entries</button>
    <!-- Single toggle used by JS: sign in/out -->
    <button id="menu-login" class="menu-item" role="menuitem" data-state="signed-out">Sign in with Google</button>
    <hr class="menu-sep"/>
    <button id="menu-about" class="menu-item" role="menuitem">About</button>
  </div>
  <div id="menu-backdrop" class="menu-backdrop" hidden></div>

  <main class="shell" role="main">
    <section class="card" aria-labelledby="log-title">
      <div class="card-h">
        <h1 id="log-title" class="card-t">Your work sessions</h1>
        <span id="count" class="badge" aria-live="polite">0 entries</span>
      </div>

      <!-- Dynamic table target -->
      <div class="table-wrap" id="tableWrap" role="region" aria-label="Work log table"></div>
    </section>

    <!-- Project lanes (same width as table/card) -->
    <div id="projectsWrap" style="margin-top:16px;"></div>
  </main>

  <!-- Add/Edit Modal -->
  <dialog id="entryDialog" class="add-entry">
    <form method="dialog" id="entryForm">
      <h3>Add work log</h3>

      <label>Task*
        <input id="task" required />
      </label>

      <label>Project*
        <input id="project" required />
      </label>

      <label>Minutes*
        <input id="minutes" type="number" min="1" step="1" required />
      </label>

      <label>Date*
        <div class="date-row" style="display:flex; gap:.5rem; align-items:center;">
          <!-- type="date" uses native picker; JS also supports dd/mm/yyyy text -->
          <input id="date" type="date" placeholder="dd/mm/yyyy" />
          <button type="button" id="date-today">Today</button>
        </div>
        <small>Use dd/mm/yyyy or click “Today”.</small>
      </label>

      <label>Notes
        <textarea id="fNotes" rows="3" placeholder="Optional"></textarea>
      </label>

      <menu style="display:flex; gap:.5rem; justify-content:flex-end">
        <button type="button" id="cancel">Cancel</button>
        <button type="button" id="save">Save</button>
      </menu>
    </form>
  </dialog>

  <!-- About modal -->
  <div id="about" class="modal" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="about-title">
    <div class="modal-h">
      <h2 id="about-title">About Work Log</h2>
      <button id="about-close" class="modal-close" aria-label="Close">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="modal-c">
      <p>Minimal, privacy-friendly work tracker. Sign in with Google to keep your log private to you. Powered by Supabase (RLS enforced).</p>
    </div>
  </div>
  <div id="about-backdrop" class="modal-backdrop" hidden></div>

  <!-- (optional) lightweight calendar: Flatpickr - keep if you plan to initialize it in JS
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  -->

  <!-- (optional) XLSX export -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>

  <!-- App (modules load deferred) -->
  <script type="module" src="./js/ui.js" defer></script>
  <script type="module" src="./js/main.js" defer></script>
</body>
</html>
